<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyBuddy - Flashcards</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .page-wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 { color: #667eea; font-size: 28px; }

        /* â”€â”€ Toolbar â”€â”€ */
        .toolbar {
            background: white;
            padding: 14px 18px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toolbar label { font-weight: 600; color: #555; font-size: 14px; white-space: nowrap; }

        .sort-select {
            padding: 8px 36px 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            color: #333;
            background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667eea' d='M6 8L1 3h10z'/%3E%3C/svg%3E") no-repeat right 12px center;
            appearance: none;
            cursor: pointer;
            transition: border-color 0.3s;
            min-width: 220px;
        }

        .sort-select:focus { outline: none; border-color: #667eea; }

        .sort-badge { margin-left: auto; font-size: 13px; color: #888; }

        /* â”€â”€ Subject group header â”€â”€ */
        .subject-group-header {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }

        .subject-group-header span {
            font-weight: 700;
            color: white;
            font-size: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 4px 14px;
            border-radius: 20px;
        }

        .subject-group-header hr { flex: 1; border: none; border-top: 2px solid rgba(255,255,255,0.4); }

        /* â”€â”€ Deck Grid â”€â”€ */
        .deck-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .deck-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .deck-card:hover { transform: translateY(-5px); box-shadow: 0 8px 12px rgba(0,0,0,0.15); }

        .deck-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .create-deck-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            border: 3px dashed rgba(255,255,255,0.5);
        }

        .create-deck-card:hover { border-color: white; background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }

        .create-icon { font-size: 48px; margin-bottom: 10px; }
        .create-deck-card h3 { font-size: 20px; font-weight: 600; }

        .deck-title { color: #333; font-size: 18px; font-weight: 600; margin-bottom: 5px; }
        .deck-class { color: #667eea; font-size: 14px; font-weight: 500; }
        .deck-meta { font-size: 12px; color: #aaa; margin-top: 4px; }

        .deck-stats {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .stat { display: flex; flex-direction: column; gap: 3px; }
        .stat-label { color: #888; font-size: 12px; }
        .stat-value { color: #333; font-size: 16px; font-weight: 600; }

        .progress-bar { width: 100%; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.3s ease; }

        /* â”€â”€ Modal â”€â”€ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .modal-content h2 { color: #333; margin-bottom: 20px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: #333; font-weight: 500; margin-bottom: 8px; }
        .form-group input, .form-group select {
            width: 100%; padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }

        .button-group { display: flex; gap: 10px; justify-content: flex-end; }

        .btn { padding: 12px 24px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(102,126,234,0.4); }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }

        @media (max-width: 768px) {
            .deck-grid { grid-template-columns: 1fr; }
            .toolbar { flex-wrap: wrap; }
            .sort-badge { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <header>
            <h1>ðŸ“š StudyBuddy Flashcards</h1>
        </header>

        <div class="toolbar">
            <label for="sortSelect">Sort by:</label>
            <select class="sort-select" id="sortSelect">
                <optgroup label="Name">
                    <option value="name-asc">Name (A â†’ Z)</option>
                    <option value="name-desc">Name (Z â†’ A)</option>
                </optgroup>
                <optgroup label="Date Modified">
                    <option value="date-desc">Date Modified (Newest First)</option>
                    <option value="date-asc">Date Modified (Oldest First)</option>
                </optgroup>
                <optgroup label="Subject">
                    <option value="subject">Subject (Grouped)</option>
                </optgroup>
            </select>
            <span class="sort-badge" id="sortBadge"></span>
        </div>

        <div class="deck-grid" id="deckGrid">
            <div class="deck-card create-deck-card" id="createDeckBtn">
                <div class="create-icon">+</div>
                <h3>Create New Deck</h3>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="createDeckModal">
        <div class="modal-content">
            <h2>Create New Flashcard Deck</h2>
            <form id="createDeckForm">
                <div class="form-group">
                    <label for="deckTitle">Deck Title</label>
                    <input type="text" id="deckTitle" required placeholder="e.g., Chapter 5: Algorithms">
                </div>
                <div class="form-group">
                    <label for="deckClass">Class</label>
                    <select id="deckClass" required>
                        <option value="">Select a class...</option>
                    </select>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Deck</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const classes = [
            { id: 'cs101',   name: 'Computer Science 101' },
            { id: 'math201', name: 'Calculus II' },
            { id: 'phys150', name: 'Physics I' },
            { id: 'eng210',  name: 'Engineering Design' }
        ];

        let decks = [
            { id: 1, title: 'Data Structures Basics',  class: 'cs101',   cards: 24, mastered: 18, dateModified: new Date('2025-04-10') },
            { id: 2, title: 'Sorting Algorithms',      class: 'cs101',   cards: 15, mastered: 10, dateModified: new Date('2025-04-01') },
            { id: 3, title: 'Integration Techniques',  class: 'math201', cards: 30, mastered: 22, dateModified: new Date('2025-04-14') },
            { id: 4, title: 'Limits and Derivatives',  class: 'math201', cards: 20, mastered: 15, dateModified: new Date('2025-03-28') },
            { id: 5, title: "Newton's Laws",           class: 'phys150', cards: 18, mastered: 12, dateModified: new Date('2025-04-08') },
            { id: 6, title: 'Kinematics',              class: 'phys150', cards: 25, mastered: 20, dateModified: new Date('2025-04-15') },
            { id: 7, title: 'Design Process',          class: 'eng210',  cards: 12, mastered: 8,  dateModified: new Date('2025-03-20') }
        ];

        let currentSort = 'name-asc';

        function getSortedDecks() {
            const sorted = [...decks];
            switch (currentSort) {
                case 'name-asc':  return sorted.sort((a, b) => a.title.localeCompare(b.title));
                case 'name-desc': return sorted.sort((a, b) => b.title.localeCompare(a.title));
                case 'date-desc': return sorted.sort((a, b) => b.dateModified - a.dateModified);
                case 'date-asc':  return sorted.sort((a, b) => a.dateModified - b.dateModified);
                case 'subject':
                    return sorted.sort((a, b) => {
                        const nameA = classes.find(c => c.id === a.class)?.name || '';
                        const nameB = classes.find(c => c.id === b.class)?.name || '';
                        return nameA.localeCompare(nameB) || a.title.localeCompare(b.title);
                    });
                default: return sorted;
            }
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function updateSortBadge(count) {
            const labels = {
                'name-asc':  `${count} deck${count !== 1 ? 's' : ''} â€” A â†’ Z`,
                'name-desc': `${count} deck${count !== 1 ? 's' : ''} â€” Z â†’ A`,
                'date-desc': `${count} deck${count !== 1 ? 's' : ''} â€” newest first`,
                'date-asc':  `${count} deck${count !== 1 ? 's' : ''} â€” oldest first`,
                'subject':   `${count} deck${count !== 1 ? 's' : ''} â€” grouped by subject`,
            };
            document.getElementById('sortBadge').textContent = labels[currentSort] || '';
        }

        function renderDecks() {
            const deckGrid = document.getElementById('deckGrid');
            const createBtn = document.getElementById('createDeckBtn');

            deckGrid.innerHTML = '';
            deckGrid.appendChild(createBtn);

            const sorted = getSortedDecks();
            updateSortBadge(sorted.length);

            let lastSubject = null;

            sorted.forEach(deck => {
                const classInfo = classes.find(c => c.id === deck.class);
                const progress = (deck.mastered / deck.cards) * 100;

                if (currentSort === 'subject' && classInfo.name !== lastSubject) {
                    lastSubject = classInfo.name;
                    const header = document.createElement('div');
                    header.className = 'subject-group-header';
                    header.innerHTML = `<span>${classInfo.name}</span><hr>`;
                    deckGrid.appendChild(header);
                }

                const card = document.createElement('div');
                card.className = 'deck-card';
                card.innerHTML = `
                    <div class="deck-title">${deck.title}</div>
                    <div class="deck-class">${classInfo.name}</div>
                    <div class="deck-meta">Modified ${formatDate(deck.dateModified)}</div>
                    <div class="deck-stats">
                        <div class="stat">
                            <span class="stat-label">Total Cards</span>
                            <span class="stat-value">${deck.cards}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Mastered</span>
                            <span class="stat-value">${deck.mastered}</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width:${progress}%"></div>
                    </div>
                `;
                card.addEventListener('click', () => openDeck(deck.id));
                deckGrid.appendChild(card);
            });
        }

        function populateClassSelect() {
            const select = document.getElementById('deckClass');
            classes.forEach(cls => {
                const opt = document.createElement('option');
                opt.value = cls.id;
                opt.textContent = cls.name;
                select.appendChild(opt);
            });
        }

        document.getElementById('sortSelect').addEventListener('change', e => {
            currentSort = e.target.value;
            renderDecks();
        });

        const modal = document.getElementById('createDeckModal');
        const createDeckBtn = document.getElementById('createDeckBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const createDeckForm = document.getElementById('createDeckForm');

        createDeckBtn.addEventListener('click', () => modal.classList.add('active'));
        cancelBtn.addEventListener('click', () => { modal.classList.remove('active'); createDeckForm.reset(); });
        modal.addEventListener('click', e => { if (e.target === modal) { modal.classList.remove('active'); createDeckForm.reset(); } });

        createDeckForm.addEventListener('submit', e => {
            e.preventDefault();
            const title   = document.getElementById('deckTitle').value;
            const classId = document.getElementById('deckClass').value;

            decks.push({ id: decks.length + 1, title, class: classId, cards: 0, mastered: 0, dateModified: new Date() });

            renderDecks();
            modal.classList.remove('active');
            createDeckForm.reset();
            alert(`Deck "${title}" created successfully!`);
        });

        function openDeck(deckId) {
            // Save current sort so homepage can restore it when user comes back
            sessionStorage.setItem('lastSort', currentSort);
            window.location.href = `flashcards-individual.html?deckId=${deckId}`;
        }

        function init() {
            populateClassSelect();

            // Restore sort selection if user came back from dashboard
            const savedSort = sessionStorage.getItem('lastSort');
            if (savedSort) {
                currentSort = savedSort;
                document.getElementById('sortSelect').value = savedSort;
            }

            renderDecks();
        }

        init();
    </script>
</body>
</html>