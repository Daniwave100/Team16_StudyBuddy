<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StudyBuddy Quiz</title>

  <!-- Modern web font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#020617;
      --surface:#020617;
      --card:#020617;
      --border:rgba(148,163,184,.35);
      --text:#e5e7eb;
      --muted:#9ca3af;
      --muted2:#6b7280;
      --accent:#6366f1;
      --accent2:#22c55e;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --shadow:0 24px 80px rgba(15,23,42,.75);
      --radius:18px;
      --radius2:12px;
      --max:760px;
      --font:'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    *, *::before, *::after{
      box-sizing:border-box;
    }

    body{
      margin:0;
      min-height:100vh;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 10% 0%, rgba(99,102,241,.24), transparent 60%),
        radial-gradient(900px 500px at 100% 0%, rgba(56,189,248,.18), transparent 55%),
        #020617;
      -webkit-font-smoothing: antialiased;
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    .topbar{
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: linear-gradient(to bottom, rgba(2,6,23,.95), rgba(2,6,23,.92));
      border-bottom:1px solid rgba(15,23,42,.8);
    }

    .topbar .wrap{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 16px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:600;
      letter-spacing:.01em;
    }

    .logo{
      width:28px;
      height:28px;
      border-radius:10px;
      background: conic-gradient(from 160deg, #6366f1, #22c55e, #38bdf8, #6366f1);
      box-shadow: 0 8px 26px rgba(15,23,42,.9);
    }

    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(51,65,85,.9);
      background:rgba(15,23,42,.92);
      font-size:13px;
      color:var(--muted);
    }

    main.wrap{
      padding-top:32px;
    }

    h1{
      margin:0 0 10px;
      font-size:26px;
      font-weight:700;
      letter-spacing:.01em;
    }

    h2{
      margin:0 0 6px;
      font-size:20px;
      font-weight:600;
    }

    h3{
      margin:4px 0 6px;
      font-size:17px;
      font-weight:600;
    }

    p{
      margin:0 0 10px;
      color:var(--muted);
      line-height:1.55;
      font-size:14px;
    }

    .small{
      font-size:13px;
      color:var(--muted);
    }

    .wrap section{
      margin-bottom:20px;
    }

    .card{
      background: radial-gradient(circle at top left, rgba(15,23,42,.9), rgba(15,23,42,.96));
      border-radius: var(--radius);
      border:1px solid rgba(30,64,175,.85);
      box-shadow: var(--shadow);
      padding:20px 18px 18px;
    }

    .divider{
      height:1px;
      width:100%;
      background:radial-gradient(circle, rgba(148,163,184,.7), transparent 70%);
      opacity:.65;
      margin:14px 0;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .grid{
      display:grid;
      gap:12px;
    }

    @media(min-width: 720px){
      .grid.cols-2{
        grid-template-columns: 2.1fr 1.2fr;
      }
    }

    .btn{
      border:0;
      cursor:pointer;
      padding:10px 14px;
      border-radius:999px;
      background:rgba(15,23,42,1);
      color:var(--text);
      font-weight:600;
      font-size:14px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:background .18s ease, transform .18s ease, box-shadow .18s ease, opacity .12s ease;
      box-shadow:0 0 0 1px rgba(51,65,85,.9);
    }

    .btn:hover{
      background:rgba(15,23,42,1);
      transform:translateY(-1px);
      box-shadow:0 16px 40px rgba(0,0,0,.45);
    }

    .btn.primary{
      background:linear-gradient(135deg, #6366f1, #38bdf8);
      box-shadow:0 14px 40px rgba(79,70,229,.55);
      border:none;
    }

    .btn.primary:hover{
      filter:brightness(1.05);
    }

    .btn.ghost{
      background:transparent;
      box-shadow:0 0 0 1px rgba(51,65,85,.9);
    }

    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(51,65,85,.9);
      background:rgba(15,23,42,.9);
      color:var(--muted);
      font-size:12px;
      font-weight:600;
    }

    .pill.good{
      border-color:rgba(34,197,94,.7);
      color:rgba(220,252,231,.98);
      background:rgba(21,128,61,.28);
    }

    .pill.bad{
      border-color:rgba(248,113,113,.85);
      color:rgba(254,242,242,.98);
      background:rgba(185,28,28,.35);
    }

    .pill.warn{
      border-color:rgba(251,191,36,.8);
      color:rgba(255,251,235,.98);
      background:rgba(202,138,4,.38);
    }

    .progress{
      width:100%;
      height:10px;
      border-radius:999px;
      background:rgba(15,23,42,1);
      border:1px solid rgba(30,64,175,.8);
      overflow:hidden;
    }

    .progress > div{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, #6366f1, #22c55e);
      transition: width .25s ease;
    }

    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .item{
      padding:10px 12px;
      border-radius:var(--radius2);
      border:1px solid rgba(31,41,55,.95);
      background:rgba(15,23,42,.9);
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }

    .opt{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:11px 12px;
      border-radius:var(--radius2);
      border:1px solid rgba(31,41,55,.95);
      background:rgba(15,23,42,.9);
      cursor:pointer;
      transition:background .17s ease, border-color .17s ease, box-shadow .17s ease, transform .17s ease;
      user-select:none;
    }

    .opt:hover{
      background:rgba(15,23,42,1);
      border-color:rgba(79,70,229,.9);
      box-shadow:0 10px 28px rgba(15,23,42,.8);
      transform:translateY(-1px);
    }

    .opt input{
      margin-top:3px;
      accent-color:#6366f1;
    }

    .opt.selected{
      border-color:#6366f1;
      box-shadow:0 0 0 1px rgba(79,70,229,.8);
    }

    .opt.correct{
      border-color:rgba(34,197,94,.8);
      background:rgba(21,128,61,.25);
    }

    .opt.wrong{
      border-color:rgba(248,113,113,.85);
      background:rgba(185,28,28,.25);
    }

    .hidden{
      display:none !important;
    }

    .kpi{
      padding:12px 12px 10px;
      border-radius:var(--radius2);
      border:1px solid rgba(30,64,175,.9);
      background:rgba(15,23,42,.9);
    }

    .kpi .big{
      font-size:22px;
      font-weight:700;
    }

    .kpi .lbl{
      font-size:12px;
      color:var(--muted2);
      margin-top:2px;
      letter-spacing:.03em;
      text-transform:uppercase;
    }

    .tag{
      font-size:12px;
      color:var(--muted);
      border:1px solid rgba(51,65,85,.9);
      padding:4px 9px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
    }

    .field{
      margin-top:14px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .field-label{
      font-size:13px;
      color:var(--muted);
      font-weight:600;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .field-inline{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    input[type="number"],
    input[type="text"],
    input[type="email"],
    input[type="password"]{
      background:#020617;
      border-radius:10px;
      border:1px solid rgba(51,65,85,.9);
      padding:7px 9px;
      color:var(--text);
      font-family:var(--font);
      font-size:14px;
    }

    input[type="number"]:focus,
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus{
      outline:none;
      border-color:#38bdf8;
      box-shadow:0 0 0 1px rgba(56,189,248,.65);
    }

    @media (max-width: 480px){
      .topbar .wrap{
        padding-inline:12px;
      }
      .card{
        padding-inline:14px;
      }
      h1{
        font-size:22px;
      }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div>StudyBuddy</div>
          <div style="font-size:12px; color:var(--muted2); font-weight:700;">Quiz</div>
        </div>
      </div>

      <div class="chip">ðŸ‘¤ <strong>Azka</strong></div>
    </div>
  </div>

  <main class="wrap">
    <!-- SETUP -->
    <section id="setup" class="hidden">
      <div class="card">
        <h1>Automata practice quiz</h1>
        <p>
          Answer a few multiple-choice questions. When youâ€™re done, youâ€™ll see your score,
          a breakdown by question, and which topics to review.
        </p>

        <div class="divider"></div>

        <div class="row" style="justify-content:space-between; align-items:flex-start;">
          <div>
            <div class="small">Quiz summary</div>
            <div class="row" style="margin-top:6px;">
              <span class="tag" id="setTopic">Automata</span>
              <span class="tag" id="setDiff">Medium</span>
              <span class="tag" id="setCount">3 questions</span>
            </div>

            <div class="field">
              <label class="field-label">
                <input type="checkbox" id="enableTimer" /> Enable timer
              </label>
              <div class="field-inline">
                <label class="small" for="timerMinutes">Time limit (minutes)</label>
                <input type="number" id="timerMinutes" min="1" max="120" value="10" style="width:80px;" />
              </div>
              <p class="small">
                If enabled, a countdown starts when the quiz begins. When time is up, your quiz
                is automatically submitted.
              </p>
            </div>
          </div>
          <button class="btn primary" id="btnStart">Start quiz</button>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="hidden">
      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:center;">
          <div>
            <h2 id="quizTitle">Automata quiz</h2>
            <p class="small" id="quizMeta">3 questions â€¢ Medium</p>
          </div>
          <span class="pill" id="topicPill">Topic: Mixed</span>
        </div>

        <div class="divider"></div>

        <div class="row" style="justify-content:space-between; align-items:center;">
          <span class="pill" id="qCounter">Question 1 / 3</span>
          <span class="pill" id="qTopic">DFA</span>
          <span class="pill" id="timerDisplay">No timer</span>
        </div>

        <div style="margin:10px 0 12px;">
          <div class="progress"><div id="bar"></div></div>
        </div>

        <h3 id="qText">Loadingâ€¦</h3>
        <p id="qHint" class="small">Pick one answer.</p>

        <div id="options" class="list" style="margin-top:10px;"></div>

        <div class="divider"></div>

        <div class="row" style="justify-content:space-between;">
          <button class="btn ghost" id="btnPrev">Back</button>
          <div class="row">
            <button class="btn" id="btnSkip">Skip</button>
            <button class="btn primary" id="btnNext" disabled>Next</button>
          </div>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="results" class="hidden">
      <div class="card">
        <h2>Your results</h2>
        <p class="small">Hereâ€™s how you did on this quiz.</p>

        <div class="divider"></div>

        <div class="grid" style="grid-template-columns:repeat(3,1fr); gap:12px;">
          <div class="kpi"><div class="big" id="scorePct">â€”</div><div class="lbl">Score</div></div>
          <div class="kpi"><div class="big" id="scoreRaw">â€”</div><div class="lbl">Correct</div></div>
          <div class="kpi"><div class="big" id="missedCount">â€”</div><div class="lbl">Missed</div></div>
        </div>

        <div class="divider"></div>

        <h3>Question review</h3>
        <div class="list" id="reviewList"></div>

        <div class="divider"></div>
        <div class="row">
          <button class="btn primary" id="goWeakTopics">See weak topics</button>
          <button class="btn ghost" id="retryQuiz">Retry quiz</button>
        </div>
      </div>
    </section>

    <!-- WEAK TOPICS -->
    <section id="weak" class="hidden">
      <div class="card">
        <h2>Weak topics</h2>
        <p class="small">Topics where you missed questions. Use this to decide what to review next.</p>

        <div class="divider"></div>

        <div class="list" id="weakList"></div>

        <div class="divider"></div>

        <div class="row">
          <button class="btn primary" id="practiceAgain">Practice again</button>
          <button class="btn ghost" id="backToResults">Back to results</button>
        </div>

        <div class="divider"></div>

        <h3>Suggested next steps</h3>
        <div class="list" id="recommendations"></div>
      </div>
    </section>

  </main>

  <script>
    // ---------- Dummy quiz data ----------
    const QUESTIONS = [
      {
        id: "q1",
        topic: "DFA",
        text: "In a DFA, for each state and input symbol, how many transitions are allowed?",
        hint: "D = deterministic",
        options: ["0", "1", "2", "Any number"],
        correct: 1,
        explanation: "A DFA must have exactly ONE transition per symbol from each state."
      },
      {
        id: "q2",
        topic: "NFA",
        text: "What makes an NFA different from a DFA?",
        hint: "Think: branching paths",
        options: [
          "It can have multiple transitions for the same symbol",
          "It has no accept states",
          "It cannot read input",
          "It must accept every path"
        ],
        correct: 0,
        explanation: "An NFA can have multiple possible next states (and sometimes Îµ-moves)."
      },
      {
        id: "q3",
        topic: "Regularity",
        text: "A language is 'regular' if it can be recognized by:",
        hint: "Three equivalent forms",
        options: [
          "A Turing machine only",
          "A DFA/NFA (finite automaton)",
          "A pushdown automaton",
          "A context-free grammar only"
        ],
        correct: 1,
        explanation: "Regular languages are exactly those recognized by finite automata (DFA/NFA) and regex."
      }
    ];

    // ---------- App state ----------
    let idx = 0;
    const answers = {}; // questionId -> selected option index (or null)
    let lastScore = null;
    const quizConfig = {
      timerEnabled: false,
      timerSeconds: 0,
    };
    let timerInterval = null;
    let timerRemaining = 0;

    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);
    const navButtons = document.querySelectorAll(".nav button");
    const pages = ["setup","quiz","results","weak"];

    function showPage(name){
      pages.forEach(p => {
        const el = $(p);
        if (el) el.classList.toggle("hidden", p !== name);
      });
      navButtons.forEach(b => b.classList.toggle("active", b.dataset.page === name));
    }

    function formatTime(totalSeconds){
      const m = Math.floor(totalSeconds / 60);
      const s = totalSeconds % 60;
      return `${m}:${s.toString().padStart(2,"0")}`;
    }

    function updateTimerDisplay(label){
      const el = $("timerDisplay");
      if (!el) return;
      el.textContent = label;
    }

    function stopTimer(){
      if (timerInterval){
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function startTimer(){
      stopTimer();
      if (!quizConfig.timerEnabled || !quizConfig.timerSeconds){
        updateTimerDisplay("No timer");
        return;
      }
      timerRemaining = quizConfig.timerSeconds;
      updateTimerDisplay(`Time left: ${formatTime(timerRemaining)}`);
      timerInterval = setInterval(() => {
        timerRemaining--;
        if (timerRemaining <= 0){
          stopTimer();
          updateTimerDisplay("Time's up");
          renderResults();
          showPage("results");
          return;
        }
        updateTimerDisplay(`Time left: ${formatTime(timerRemaining)}`);
      }, 1000);
    }

    function applyTimerConfigFromUI(){
      const enableEl = $("enableTimer");
      const minutesEl = $("timerMinutes");
      if (!enableEl || !minutesEl) return;
      const enabled = enableEl.checked;
      let mins = parseInt(minutesEl.value, 10);
      if (Number.isNaN(mins) || mins <= 0){
        quizConfig.timerEnabled = false;
        quizConfig.timerSeconds = 0;
      } else {
        quizConfig.timerEnabled = enabled;
        quizConfig.timerSeconds = enabled ? mins * 60 : 0;
      }
    }

    function resetQuiz(){
      idx = 0;
      for (const q of QUESTIONS) answers[q.id] = null;
      if (quizConfig.timerEnabled && quizConfig.timerSeconds > 0){
        startTimer();
      } else {
        stopTimer();
        updateTimerDisplay("No timer");
      }
      renderQuestion();
    }

    function renderQuestion(){
      const q = QUESTIONS[idx];
      $("qText").textContent = q.text;
      $("qHint").textContent = q.hint;
      $("qCounter").textContent = `Question ${idx+1} / ${QUESTIONS.length}`;
      $("qTopic").textContent = q.topic;
      $("bar").style.width = `${((idx) / QUESTIONS.length) * 100}%`;

      // buttons
      $("btnPrev").disabled = idx === 0;
      $("btnNext").textContent = (idx === QUESTIONS.length-1) ? "Finish" : "Next";

      const selected = answers[q.id];

      // build options
      $("options").innerHTML = "";
      q.options.forEach((optText, i) => {
        const div = document.createElement("label");
        div.className = "opt" + (selected === i ? " selected" : "");
        div.innerHTML = `
          <input type="radio" name="opt" ${selected === i ? "checked" : ""} />
          <div>
            <div style="font-weight:900">${optText}</div>
            <div class="small">Option ${String.fromCharCode(65+i)}</div>
          </div>
        `;
        div.addEventListener("click", () => {
          answers[q.id] = i;
          renderQuestion();
        });
        $("options").appendChild(div);
      });

      $("btnNext").disabled = (answers[q.id] === null);
      $("topicPill").textContent = "Topic: Mixed";
    }

    function computeResults(){
      let correctCount = 0;
      const missedByTopic = {}; // topic -> misses
      const review = [];

      for (const q of QUESTIONS){
        const selected = answers[q.id];
        const isCorrect = (selected === q.correct);
        if (isCorrect) correctCount++;
        else missedByTopic[q.topic] = (missedByTopic[q.topic] || 0) + 1;

        review.push({ q, selected, isCorrect });
      }

      const total = QUESTIONS.length;
      const pct = Math.round((correctCount / total) * 100);
      lastScore = { correctCount, total, pct, missedByTopic, review };

      return lastScore;
    }

    function renderResults(){
      stopTimer();
      const res = computeResults();
      $("scorePct").textContent = res.pct + "%";
      $("scoreRaw").textContent = `${res.correctCount} / ${res.total}`;
      $("missedCount").textContent = (res.total - res.correctCount);

      // review list
      const list = $("reviewList");
      list.innerHTML = "";
      res.review.forEach((r, i) => {
        const pillClass = r.isCorrect ? "pill good" : "pill bad";
        const pillText = r.isCorrect ? "Correct" : "Wrong";
        const chosen = (r.selected === null) ? "Skipped" : r.q.options[r.selected];
        const correct = r.q.options[r.q.correct];

        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div style="max-width:72%">
            <div style="font-weight:900">${i+1}. ${r.q.text}</div>
            <div class="small">Topic: ${r.q.topic}</div>
            <div class="divider" style="margin:10px 0"></div>
            <div class="small"><strong>Your answer:</strong> ${chosen}</div>
            <div class="small"><strong>Correct:</strong> ${correct}</div>
            ${r.isCorrect ? "" : `<div class="small" style="margin-top:6px;"><strong>Why:</strong> ${r.q.explanation}</div>`}
          </div>
          <div><span class="${pillClass}">${pillText}</span></div>
        `;
        list.appendChild(div);
      });
    }

    function renderWeakTopics(){
      const res = lastScore || computeResults();
      const weakList = $("weakList");
      weakList.innerHTML = "";

      const entries = Object.entries(res.missedByTopic);
      if (entries.length === 0){
        weakList.innerHTML = `
          <div class="item">
            <div>
              <div style="font-weight:900">No weak topics ðŸŽ‰</div>
              <div class="small">You got everything correct. Try a harder difficulty next.</div>
            </div>
            <span class="pill good">Great</span>
          </div>
        `;
      } else {
        entries.sort((a,b) => b[1] - a[1]);
        entries.forEach(([topic, misses]) => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <div>
              <div style="font-weight:900">${topic}</div>
              <div class="small">Missed ${misses} question(s) in this topic.</div>
            </div>
            <span class="pill warn">Focus</span>
          `;
          weakList.appendChild(div);
        });
      }

      // recommendations (dummy)
      const rec = $("recommendations");
      rec.innerHTML = "";
      const recItems = [
        { title: "Review 1-page summary", desc: "Skim definitions + key rules for your weak topics." },
        { title: "Do 5 quick practice Qs", desc: "Same topic, short questions, immediate feedback." },
        { title: "Retry quiz", desc: "Retake to see if your weak topics improve." }
      ];
      recItems.forEach(x => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div>
            <div style="font-weight:900">${x.title}</div>
            <div class="small">${x.desc}</div>
          </div>
          <span class="pill">Next</span>
        `;
        rec.appendChild(div);
      });
    }

    // ---------- Navigation wiring ----------
    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const p = btn.dataset.page;
        // basic guards
        if (p === "quiz" && Object.values(answers).every(v => v === null)) resetQuiz();
        if (p === "results") renderResults();
        if (p === "weak") renderWeakTopics();
        showPage(p);
      });
    });

    const startBtn = $("btnStart");
    if (startBtn){
      startBtn.addEventListener("click", () => {
        applyTimerConfigFromUI();
        resetQuiz();
        showPage("quiz");
      });
    }

    const goWeakBtn = $("goWeakTopics");
    if (goWeakBtn){
      goWeakBtn.addEventListener("click", () => {
        renderWeakTopics();
        showPage("weak");
      });
    }

    $("retryQuiz").addEventListener("click", () => { resetQuiz(); showPage("quiz"); });
    $("practiceAgain").addEventListener("click", () => { resetQuiz(); showPage("quiz"); });
    $("backToResults").addEventListener("click", () => { renderResults(); showPage("results"); });

    // quiz buttons
    $("btnPrev").addEventListener("click", () => {
      if (idx > 0) idx--;
      renderQuestion();
    });

    $("btnSkip").addEventListener("click", () => {
      const q = QUESTIONS[idx];
      answers[q.id] = null;
      if (idx < QUESTIONS.length - 1){
        idx++;
        renderQuestion();
      } else {
        $("bar").style.width = `100%`;
        renderResults();
        showPage("results");
      }
    });

    $("btnNext").addEventListener("click", () => {
      if (idx < QUESTIONS.length - 1){
        idx++;
        renderQuestion();
      } else {
        $("bar").style.width = `100%`;
        renderResults();
        showPage("results");
      }
    });

    // initial load
    resetQuiz();
    showPage("setup");
  </script>
</body>
</html>